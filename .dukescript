#!groovy

node ('Mac') {
    stage('Build') {
        checkout scm

        jdk = tool name: 'JDK8u212'
        env.JAVA_HOME = "${jdk}"

        if (env.GPG_DIR) {
            env.PATH="${env.PATH}:${env.GPG_DIR}"
        }

        withMaven(
            maven : 'M3',
            mavenSettingsConfig : '1745afa9-9479-4838-b15d-14029f4cfc8d'
        ) {
            withCredentials([file(credentialsId: 'KEYSTORES_DUKESCRIPT_RELEASES', variable: 'KEYSTORE')]) {
                sh "mvn -DskipTests clean package source:jar javadoc:jar gpg:sign deploy -Dgpg.defaultKeyring=false -Dgpg.privateKeyring=${env.KEYSTORE} -Dgpg.keyname=eppleton"
            }
        }
    }
}
